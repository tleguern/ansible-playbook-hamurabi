---
- name: How many acres do you wish to sell?
  pause:
    prompt: "How many acres do you wish to sell?"
  register: sell

- name: Check user input for stupid answers.
  fail:
    msg: |
      Hamurabi: I cannot do what you wish.
      Get yourself another steward!
  when:
    - sell.user_input is not integer
    - sell.user_input|int < 0

- name: Calculate total price.
  set_fact:
    price: "{{ landrate|int * sell.user_input|int }}"

- name: Nope.
  debug:
    msg: "Hamurabi: Think again. You have only {{ bushels }} acres."
  when: sell.user_input|int > acres|int

- name: Try again Hamurabi.
  include_tasks: sell-acres.yml
  when: sell.user_input|int > acres|int

- block:
    - name: Sell the land, pride of our nation.
      set_fact:
        acres: "{{ acres|int - sell.user_input|int }}"

    - name: And grab the bushels.
      set_fact:
        bushels: "{{ bushels|int + price|int }}"
  when: sell.user_input|int <= acres|int
