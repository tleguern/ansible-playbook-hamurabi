---
- include_tasks: action-buy.yml
  when: interactive

- name: Check user input for stupid answers.
  fail:
    msg: |
      Hamurabi: I cannot do what you wish.
      Get yourself another steward!
  register: action_error
  when: action.user_input is string
        or action.user_input|int < 0

- name: Calculate total price.
  set_fact:
    price: "{{ landrate|int * action.user_input|int }}"

- name: Nope.
  fail:
    msg: "Hamurabi: Think again. You have only {{ bushels }} bushels of grain."
  register: action_failed
  ignore_errors: "{{ interactive }}"
  when: price|int > bushels|int

- name: Try again Hamurabi.
  include_tasks: buy-acres.yml
  when:
    - price|int > bushels|int
    - interactive

- name: Pay the landlords in bushels.
  set_fact:
    bushels: "{{ bushels|int - price|int }}"

- name: And grab their land.
  set_fact:
    acres: "{{ acres|int + action.user_input|int }}"
